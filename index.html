<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Cashflow</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon-192.png">
  <meta name="theme-color" content="#2563eb">
  <meta name="apple-mobile-web-app-capable" content="yes">

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    * { box-sizing: border-box; font-family: 'Poppins', sans-serif; }
    body { background:#f1f5f9; margin:0; padding:1rem; color:#0f172a; }
    h1 { text-align:center; margin-bottom:1rem; }

    .container { max-width:900px; margin:auto; display:grid; gap:1rem; }
    .card { background:#fff; padding:1rem; border-radius:16px; box-shadow:0 6px 20px rgba(0,0,0,.06); }

    .summary { display:grid; grid-template-columns:repeat(3,1fr); gap:.7rem; }
    .income { background:#dbeafe; }
    .expense { background:#fee2e2; }
    .balance { background:#dcfce7; }

    .summary div { padding:1rem; border-radius:12px; text-align:center; }
    .summary h3 { margin:0; font-size:.9rem; }
    .summary p { margin:.4rem 0 0; font-weight:700; }

    form, .filters {
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
      gap:.6rem;
    }

    input, select, button {
      padding:.6rem;
      border-radius:10px;
      border:1px solid #cbd5e1;
    }

    button {
      background:#2563eb;
      color:white;
      font-weight:600;
      border:none;
      cursor:pointer;
    }

    table { width:100%; border-collapse:collapse; font-size:.85rem; }
    th, td { padding:.6rem; border-bottom:1px solid #e5e7eb; }
    th { background:#f8fafc; }

    .type-income { color:#2563eb; font-weight:600; }
    .type-expense { color:#dc2626; font-weight:600; }

    .btn-delete {
      background:#ef4444;
      color:white;
      border:none;
      padding:.3rem .6rem;
      border-radius:6px;
      font-size:.75rem;
      cursor:pointer;
    }

    @media (max-width:600px) {
      .summary { grid-template-columns:1fr; }
      table { font-size:.8rem; }
    }
  </style>
</head>
<body>

<h1>ðŸ’° Cashflow</h1>

<div class="container">

  <!-- Ringkasan -->
  <div class="card summary">
    <div class="income">
      <h3>Pemasukan</h3>
      <p id="totalIncome">Rp 0</p>
    </div>
    <div class="expense">
      <h3>Pengeluaran</h3>
      <p id="totalExpense">Rp 0</p>
    </div>
    <div class="balance">
      <h3>Sisa Saldo</h3>
      <p id="balance">Rp 0</p>
    </div>
  </div>

  <!-- Input -->
  <div class="card">
    <h3>Input Transaksi</h3>
    <form id="transactionForm">
      <input type="date" id="date" required>
      <input type="text" id="description" placeholder="Keterangan" required>
      <select id="type">
        <option value="income">Pemasukan</option>
        <option value="expense">Pengeluaran</option>
      </select>
      <input type="number" id="amount" placeholder="Nominal" required>
      <button type="submit">Tambah</button>
    </form>
  </div>

  <!-- Filter -->
  <div class="card">
    <h3>Filter</h3>
    <div class="filters">
      <input type="month" id="filterMonth">
      <select id="filterType">
        <option value="all">Semua</option>
        <option value="income">Pemasukan</option>
        <option value="expense">Pengeluaran</option>
      </select>
      <button onclick="applyFilter()">Terapkan</button>
      <button onclick="resetFilter()">Reset</button>
    </div>
  </div>

  <!-- Tabel -->
  <div class="card">
    <h3>Catatan Transaksi</h3>
    <table>
      <thead>
        <tr>
          <th>Tanggal</th>
          <th>Keterangan</th>
          <th>Jenis</th>
          <th>Nominal</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody id="transactionTable"></tbody>
    </table>
  </div>

</div>

<script>
let transactions = JSON.parse(localStorage.getItem('cashflowData')) || [];
let filteredData = [...transactions];

const table = document.getElementById('transactionTable');
const totalIncomeEl = document.getElementById('totalIncome');
const totalExpenseEl = document.getElementById('totalExpense');
const balanceEl = document.getElementById('balance');

const formatRupiah = n => 'Rp ' + n.toLocaleString('id-ID');

function render(data = filteredData) {
  table.innerHTML = '';
  let income = 0, expense = 0;

  data.forEach((tx, index) => {
    if (tx.type === 'income') income += tx.amount;
    else expense += tx.amount;

    table.innerHTML += `
      <tr>
        <td>${tx.date}</td>
        <td>${tx.description}</td>
        <td class="${tx.type === 'income' ? 'type-income' : 'type-expense'}">
          ${tx.type === 'income' ? 'Pemasukan' : 'Pengeluaran'}
        </td>
        <td>${formatRupiah(tx.amount)}</td>
        <td>
          <button class="btn-delete" onclick="deleteTx(${index})">Hapus</button>
        </td>
      </tr>
    `;
  });

  totalIncomeEl.textContent = formatRupiah(income);
  totalExpenseEl.textContent = formatRupiah(expense);
  balanceEl.textContent = formatRupiah(income - expense);
}

function deleteTx(index) {
  if (!confirm('Hapus data ini?')) return;
  transactions.splice(index, 1);
  localStorage.setItem('cashflowData', JSON.stringify(transactions));
  resetFilter();
}

function applyFilter() {
  const month = filterMonth.value;
  const type = filterType.value;

  filteredData = transactions.filter(tx => {
    const m = month ? tx.date.startsWith(month) : true;
    const t = type === 'all' ? true : tx.type === type;
    return m && t;
  });
  render();
}

function resetFilter() {
  filteredData = [...transactions];
  filterMonth.value = '';
  filterType.value = 'all';
  render();
}

transactionForm.addEventListener('submit', e => {
  e.preventDefault();
  transactions.push({
    date: date.value,
    description: description.value,
    type: type.value,
    amount: Number(amount.value)
  });
  localStorage.setItem('cashflowData', JSON.stringify(transactions));
  resetFilter();
  e.target.reset();
});

render();
</script>

<script>
if ('serviceWorker' in navigator && location.protocol !== 'file:') {
  navigator.serviceWorker.register('service-worker.js');
}
</script>

</body>
</html>
