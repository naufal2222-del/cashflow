<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cashflow</title>

<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon-192.png">
<meta name="theme-color" content="#2563eb">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;font-family:Poppins}
body{background:#f1f5f9;margin:0;padding:1rem}
.container{max-width:900px;margin:auto;display:grid;gap:1rem}
.card{background:#fff;padding:1rem;border-radius:16px;box-shadow:0 6px 20px rgba(0,0,0,.08)}
.summary{display:grid;grid-template-columns:repeat(3,1fr);gap:.7rem}
.summary div{padding:1rem;border-radius:12px;text-align:center}
.income{background:#dbeafe}
.expense{background:#fee2e2}
.balance{background:#dcfce7}
form,.filters{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:.6rem}
input,select,button{padding:.6rem;border-radius:10px;border:1px solid #cbd5e1}
button{background:#2563eb;color:white;font-weight:600;border:none;cursor:pointer}
table{width:100%;border-collapse:collapse;font-size:.85rem}
th,td{padding:.6rem;border-bottom:1px solid #e5e7eb}
.btn-delete{background:#ef4444;color:white;border:none;padding:.3rem .6rem;border-radius:6px}
@media(max-width:600px){.summary{grid-template-columns:1fr}}
</style>
</head>

<body>
<h2 style="text-align:center">üí∞ Cashflow</h2>

<div class="container">

<div class="card summary">
  <div class="income"><h4>Pemasukan</h4><p id="in">Rp 0</p></div>
  <div class="expense"><h4>Pengeluaran</h4><p id="out">Rp 0</p></div>
  <div class="balance"><h4>Saldo</h4><p id="bal">Rp 0</p></div>
</div>

<div class="card">
<form id="form">
  <input type="date" id="date" required>
  <input type="text" id="desc" placeholder="Keterangan" required>
  <select id="type">
    <option value="income">Pemasukan</option>
    <option value="expense">Pengeluaran</option>
  </select>
  <input type="number" id="amount" placeholder="Nominal" required>
  <button>Tambah</button>
</form>
</div>

<div class="card filters">
  <input type="month" id="filterMonth">
  <select id="filterType">
    <option value="all">Semua</option>
    <option value="income">Pemasukan</option>
    <option value="expense">Pengeluaran</option>
  </select>
  <button onclick="applyFilter()">Filter</button>
  <button onclick="resetFilter()">Reset</button>
</div>

<div class="card">
  <button onclick="exportPDF()">‚¨áÔ∏è Export PDF</button>
</div>

<div class="card">
<table>
<thead>
<tr><th>Tanggal</th><th>Keterangan</th><th>Jenis</th><th>Nominal</th><th>Aksi</th></tr>
</thead>
<tbody id="list"></tbody>
</table>
</div>

</div>

<!-- jsPDF OFFLINE -->
<script src="jspdf.umd.min.js"></script>

<script>
let data = JSON.parse(localStorage.getItem('cashflow')) || []
let filtered = [...data]
const list = document.getElementById('list')

const rp = n => 'Rp ' + n.toLocaleString('id-ID')

function render(arr = filtered){
  list.innerHTML=''
  let i=0,o=0
  arr.forEach(tx=>{
    tx.type==='income'?i+=tx.amount:o+=tx.amount
    list.innerHTML+=`
    <tr>
      <td>${tx.date}</td>
      <td>${tx.desc}</td>
      <td>${tx.type}</td>
      <td>${rp(tx.amount)}</td>
      <td><button class="btn-delete" onclick="del('${tx.id}')">Hapus</button></td>
    </tr>`
  })
  in.textContent=rp(i)
  out.textContent=rp(o)
  bal.textContent=rp(i-o)
}

form.onsubmit=e=>{
  e.preventDefault()
  data.push({
    id:Date.now(),
    date:date.value,
    desc:desc.value,
    type:type.value,
    amount:+amount.value
  })
  localStorage.setItem('cashflow',JSON.stringify(data))
  resetFilter()
  form.reset()
}

function del(id){
  if(!confirm('Hapus data?'))return
  data=data.filter(d=>d.id!=id)
  localStorage.setItem('cashflow',JSON.stringify(data))
  resetFilter()
}

function applyFilter(){
  filtered=data.filter(d=>{
    return (!filterMonth.value||d.date.startsWith(filterMonth.value)) &&
           (filterType.value==='all'||d.type===filterType.value)
  })
  render()
}

function resetFilter(){
  filtered=[...data]
  filterMonth.value=''
  filterType.value='all'
  render()
}

/* ===== EXPORT PDF ===== */
function exportPDF(){
  const { jsPDF } = window.jspdf
  const pdf = new jsPDF()
  pdf.text("LAPORAN CASHFLOW", 14, 15)

  let y=25
  filtered.forEach(d=>{
    pdf.text(`${d.date} | ${d.desc} | ${d.type} | ${rp(d.amount)}`, 14, y)
    y+=7
  })

  pdf.save("cashflow.pdf")
}

render()
</script>

</body>
</html>
